<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lambda Graph Rewrite Visualization</title>
    <!-- Vis.js Network CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/dist/vis-network.min.css" rel="stylesheet" type="text/css" />
    <!-- Vis.js Network JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/vis-network.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        #network {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            background-color: #f0f8ff;
            border-radius: 4px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background-color: #fafafa;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .step-button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .step-button:hover {
            background-color: #45a049;
        }
        
        .step-button.active {
            background-color: #2196F3;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            padding: 15px;
            background-color: #fafafa;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-box {
            width: 20px;
            height: 20px;
            border: 1px solid #333;
            border-radius: 3px;
        }
        
        .description {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.6;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Lambda Graph Rewrite: ((λx.λy.x) A) B → A</h1>
        
        <div id="network"></div>
        
        <div class="controls">
            <button class="step-button active" id="step1">Step 1: Full Expression</button>
            <button class="step-button" id="step2">Step 2: First Reduction</button>
            <button class="step-button" id="step3">Step 3: Final Result</button>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box" style="background-color: #bbdefb;"></div>
                <span>Application Node</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background-color: #ffe0b2;"></div>
                <span>Lambda Abstraction</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background-color: #fff9c4;"></div>
                <span>Bound Variable</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background-color: #c8e6c9;"></div>
                <span>Input Constant</span>
            </div>
        </div>
        
        <div class="description" id="description">
            Step 1 shows the full expression: ((λx.λy.x) A) B.<br>
            There are two application nodes: App2 applies λx.λy.x to A; App1 applies the result to B.
        </div>
    </div>

    <script>
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            let network = null;
            let currentStep = 1;
            
            // Define the three steps of the reduction
            const steps = {
                1: {
                    nodes: [
                        { id: 1, label: 'App1', color: { background: '#bbdefb', border: '#333' }, level: 0 },
                        { id: 2, label: 'App2', color: { background: '#bbdefb', border: '#333' }, level: 1 },
                        { id: 3, label: 'B', color: { background: '#c8e6c9', border: '#333' }, level: 1 },
                        { id: 4, label: 'λx', color: { background: '#ffe0b2', border: '#333' }, level: 2 },
                        { id: 5, label: 'A', color: { background: '#c8e6c9', border: '#333' }, level: 2 },
                        { id: 6, label: 'λy', color: { background: '#ffe0b2', border: '#333' }, level: 3 },
                        { id: 7, label: 'x', color: { background: '#fff9c4', border: '#333' }, level: 4 }
                    ],
                    edges: [
                        { from: 1, to: 2, arrows: 'to' },
                        { from: 1, to: 3, arrows: 'to' },
                        { from: 2, to: 4, arrows: 'to' },
                        { from: 2, to: 5, arrows: 'to' },
                        { from: 4, to: 6, arrows: 'to' },
                        { from: 6, to: 7, arrows: 'to' }
                    ],
                    description: "Step 1 shows the full expression: ((λx.λy.x) A) B.<br>" +
                                "There are two application nodes: App2 applies λx.λy.x to A; App1 applies the result to B."
                },
                2: {
                    nodes: [
                        { id: 1, label: 'App1', color: { background: '#bbdefb', border: '#333' }, level: 0 },
                        { id: 2, label: 'λy', color: { background: '#ffe0b2', border: '#333' }, level: 1 },
                        { id: 3, label: 'B', color: { background: '#c8e6c9', border: '#333' }, level: 1 },
                        { id: 4, label: 'A', color: { background: '#c8e6c9', border: '#333' }, level: 2 }
                    ],
                    edges: [
                        { from: 1, to: 2, arrows: 'to' },
                        { from: 1, to: 3, arrows: 'to' },
                        { from: 2, to: 4, arrows: 'to' }
                    ],
                    description: "Step 2 shows the first β-reduction: (λx.λy.x) A → (λy.A).<br>" +
                                "App1 now applies this new function to B."
                },
                3: {
                    nodes: [
                        { id: 1, label: 'A', color: { background: '#c8e6c9', border: '#333' }, level: 0 }
                    ],
                    edges: [],
                    description: "Step 3 shows the second β-reduction: (λy.A) B → A.<br>" +
                                "The entire expression reduces to A."
                }
            };
            
            // Initialize the network
            function initNetwork() {
                const container = document.getElementById('network');
                
                if (!container) {
                    console.error('Network container not found');
                    return;
                }
                
                const options = {
                    nodes: {
                        shape: 'ellipse',
                        size: 30,
                        font: {
                            size: 16,
                            color: '#000000'
                        },
                        borderWidth: 1.5,
                        borderWidthSelected: 2
                    },
                    edges: {
                        width: 1.5,
                        color: {
                            color: '#333333',
                            highlight: '#000000'
                        },
                        smooth: {
                            type: 'cubicBezier',
                            forceDirection: 'vertical',
                            roundness: 0.4
                        }
                    },
                    layout: {
                        hierarchical: {
                            direction: 'UD',
                            sortMethod: 'directed',
                            levelSeparation: 100,
                            nodeSpacing: 150,
                            treeSpacing: 200
                        }
                    },
                    physics: {
                        enabled: false
                    },
                    interaction: {
                        dragNodes: false,
                        dragView: true,
                        zoomView: true
                    }
                };
                
                // Create initial data
                const data = {
                    nodes: new vis.DataSet(steps[1].nodes),
                    edges: new vis.DataSet(steps[1].edges)
                };
                
                try {
                    // Create the network
                    network = new vis.Network(container, data, options);
                    
                    // Fit the network to the viewport after it's rendered
                    network.once('stabilized', function() {
                        network.fit();
                    });
                } catch (error) {
                    console.error('Error creating network:', error);
                }
            }
            
            // Show a specific step
            function showStep(stepNumber) {
                if (!network) {
                    console.error('Network not initialized');
                    return;
                }
                
                currentStep = stepNumber;
                
                // Update button states
                const buttons = document.querySelectorAll('.step-button');
                buttons.forEach((btn, index) => {
                    if (index + 1 === stepNumber) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Update the network
                const stepData = steps[stepNumber];
                try {
                    network.setData({
                        nodes: new vis.DataSet(stepData.nodes),
                        edges: new vis.DataSet(stepData.edges)
                    });
                    
                    // Update description
                    document.getElementById('description').innerHTML = stepData.description;
                    
                    // Fit the network after updating
                    setTimeout(() => {
                        network.fit();
                    }, 100);
                } catch (error) {
                    console.error('Error updating network:', error);
                }
            }
            
            // Add event listeners to buttons
            document.getElementById('step1').addEventListener('click', function() {
                showStep(1);
            });
            
            document.getElementById('step2').addEventListener('click', function() {
                showStep(2);
            });
            
            document.getElementById('step3').addEventListener('click', function() {
                showStep(3);
            });
            
            // Initialize the network when everything is ready
            setTimeout(() => {
                initNetwork();
            }, 100);
        });
    </script>
</body>
</html>